<%- include('adminHeader') %>

<div class="container">

    <div class="row mt-3 mb-5">
        <div class="d-flex justify-content-end"><strong>Total Amount : <%= totalAmount %></strong></div>
    </div>
<a href="/admin_salesreport/download">Download the sales report</a>

    <div class="row mt-3 mb-4">
        <form action="/admin_salesreport" method="get">
            <div class="mb-3">
                <label for="rangeSelect" class="form-label">Select Time Range:</label>
                <select class="form-select" id="rangeSelect" name="range">
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Yearly</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Generate Report</button>
        </form>
    </div>

    <table id="salesReportTable" class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Order Date</th>
                <th>Username</th>
                <th>Product Name</th>
                <th>Product Price</th>
                <th>Product Offer</th>
                <th>Category Offer</th>
                <th>Total Offer</th>
                <th>Total Amount</th>
    
            </tr>
        </thead>
        <tbody>
            <% order.forEach(orderItem => { %>
                <% orderItem.items.forEach(item => { %>
                    <tr>
                        <td><%= orderItem.createdAt %></td>
                        <td><%= orderItem.userId.userName %></td>
                        <td><%= item.product.productName %></td>
                        <td>$<%= item.product.price %></td>
                        <td><%= item.productOfferPrice > 0 ? item.productOfferName : 'No offer' %></td>
                        <td><%= item.categoryOfferPrice > 0 ? item.categoryOfferName : 'No offer' %></td>
                        <% const totalOffer = item.productOfferPrice + item.categoryOfferPrice; %>
                        <td><%= totalOffer > 0 ? '$' + totalOffer : '-' %></td>
                        <td class="totalPrice">$<%= orderItem.totalAmount %></td>
                        
                    </tr>
                <% }) %>
            <% }) %>
        </tbody>
    </table>
</div>

<%- include('adminFooter') %>
